# Pre-Developer Testing Readiness – TODO Tracker

## Investigation Highlights
- The active decay path still relies on a stubbed `MemoryDecay` class alongside heuristic MTM/LTM decay helpers, so we lack a true time-aware forgetting engine and event emission hooks.【F:src/neuroca/memory/memory_decay.py†L1-L33】【F:src/neuroca/memory/manager/decay.py†L60-L197】
- Consolidation now routes through a transactional pipeline that pairs the weighted `MemorySummarizer` outputs with idempotent STM→MTM→LTM promotions, rolling back target writes whenever source finalization fails.【F:src/neuroca/memory/manager/consolidation_pipeline.py†L1-L106】【F:src/neuroca/memory/manager/consolidation.py†L1-L299】【F:src/neuroca/memory/manager/memory_manager.py†L120-L221】
- Consolidation requests now coordinate through an in-flight guard that caches successful promotions and bypasses duplicate retrievals before executing the transactional pipeline.【F:src/neuroca/memory/manager/consolidation_guard.py†L1-L133】【F:src/neuroca/memory/manager/memory_manager.py†L1304-L1386】【F:src/neuroca/memory/manager/consolidation.py†L133-L462】
- Retrieval latency and consolidation throughput benchmarks now exercise the full memory manager to capture live P50/P95 latency and throughput baselines, replacing the previous placeholder loops and locking the behaviour in regression tests.【F:tests/performance/benchmarks.py†L201-L504】【F:tests/unit/performance/test_performance_benchmarks.py†L1-L62】
- Prior to this update, embedding dimensions were sourced from multiple configs (settings, YAML, defaults), so we introduced a resolver, propagation logic, and regression tests to enforce a single canonical dimension.【F:src/neuroca/memory/config/embedding.py†L1-L129】【F:src/neuroca/memory/factory.py†L101-L209】【F:src/neuroca/memory/manager/memory_manager.py†L496-L500】【F:tests/unit/memory/test_factory.py†L69-L194】【F:tests/unit/memory/config/test_embedding_configuration.py†L1-L38】
- Background maintenance now runs through a centralized orchestrator that sequences tier upkeep, cleanup, decay, and consolidation while emitting telemetry and adaptive retry delays.【F:src/neuroca/memory/manager/maintenance.py†L1-L408】【F:src/neuroca/memory/manager/memory_manager.py†L567-L611】【F:src/neuroca/memory/manager/memory_manager.py†L1590-L1618】
- Memory ingestion now sanitizes content, metadata, and tags through reusable filters that redact sensitive values, reject prompt-injection attempts, and normalise tag keys before persistence.【F:src/neuroca/memory/manager/sanitization.py†L1-L191】【F:src/neuroca/memory/manager/memory_manager.py†L807-L909】【F:tests/unit/memory/manager/test_sanitization.py†L1-L137】
- The vector backend now exposes `VectorIndexMaintenance` helpers so maintenance flows can surface drift, missing payloads, and trigger metadata-driven reindex operations when embeddings go stale.【F:src/neuroca/memory/backends/vector/components/integrity.py†L1-L291】【F:src/neuroca/memory/backends/vector/core.py†L66-L354】【F:tests/unit/memory/backends/test_vector_backend.py†L53-L95】
- Maintenance telemetry now feeds a Prometheus-backed metrics publisher that emits promotion throughput, decay counts, orphan cleanup gauges, and tier utilisation snapshots for dashboards.【F:src/neuroca/memory/manager/metrics.py†L16-L215】【F:src/neuroca/memory/manager/memory_manager.py†L210-L219】【F:src/neuroca/memory/manager/memory_manager.py†L655-L669】【F:src/neuroca/memory/manager/memory_manager.py†L934-L975】

## Phase 1 – Critical Path (must ship before live agents)
- [x] Implement a production-ready decay & forgetting engine that replaces the stub, tracks time and strength decay, emits `MemoryDecay` events, and prunes items below tier thresholds.【F:src/neuroca/memory/memory_decay.py†L1-L286】【F:tests/unit/memory/test_memory_decay_engine.py†L1-L155】
- [x] Unify embedding dimension configuration using the new resolver, ensure factory/manager/tier wiring apply it, and guard against mismatched overrides with regression tests.【F:src/neuroca/memory/config/embedding.py†L1-L129】【F:src/neuroca/memory/factory.py†L101-L209】【F:src/neuroca/memory/manager/memory_manager.py†L496-L500】【F:tests/unit/memory/test_factory.py†L69-L194】【F:tests/unit/memory/config/test_embedding_configuration.py†L1-L38】
- [x] Deliver an advanced summarization module that performs semantic compression, batch aggregation, and supports pluggable backends instead of the previous one-line summary placeholder during promotion.【F:src/neuroca/memory/manager/summarization.py†L1-L420】【F:src/neuroca/memory/manager/consolidation.py†L209-L304】【F:tests/unit/memory/manager/test_summarization.py†L1-L156】
- [x] Model strength/decay balancing with bounded reinforcement curves tied into MTM/LTM maintenance so strengthening competes with passive decay rather than incrementing a single strength field.【F:src/neuroca/memory/manager/strength_decay.py†L1-L239】【F:src/neuroca/memory/manager/decay.py†L1-L223】【F:tests/unit/memory/manager/test_strength_decay_model.py†L1-L108】
- [x] Build a transactional STM→MTM→LTM consolidation pipeline with rollback and idempotency guarantees so cross-tier moves cannot orphan or duplicate records.【F:src/neuroca/memory/manager/consolidation_pipeline.py†L1-L106】【F:src/neuroca/memory/manager/consolidation.py†L74-L299】【F:src/neuroca/memory/manager/memory_manager.py†L104-L161】【F:tests/unit/memory/manager/test_transactional_consolidation.py†L1-L143】
- [x] Add consolidation deduplication and in-flight guards that prevent double promotions when background maintenance and explicit consolidations target the same IDs.【F:src/neuroca/memory/manager/consolidation_guard.py†L1-L133】【F:src/neuroca/memory/manager/memory_manager.py†L1304-L1386】【F:src/neuroca/memory/manager/consolidation.py†L133-L462】
- [x] Finish the background maintenance scheduler so decay, consolidation, cleanup, and telemetry run under a single orchestrator with error handling and rescheduling logic.【F:src/neuroca/memory/manager/maintenance.py†L1-L408】【F:src/neuroca/memory/manager/memory_manager.py†L567-L611】【F:src/neuroca/memory/manager/memory_manager.py†L1590-L1618】
- [x] Create concurrency and race-condition tests that hammer promotions and retrieval simultaneously to surface tier locking issues (current performance fixtures only simulate concurrency).【F:tests/unit/memory/manager/test_concurrency_races.py†L1-L195】
- [x] Add consolidation fault-injection tests that simulate mid-promotion failures and ensure rollback/idempotency logic behaves as expected.【F:src/neuroca/memory/manager/memory_manager.py†L1223-L1317】【F:tests/unit/memory/manager/test_transactional_consolidation.py†L126-L184】
- [x] Harden graceful shutdown to drain and finish queued maintenance or promotions before cancelling tasks, so no partial writes occur.【F:src/neuroca/memory/manager/memory_manager.py†L124-L132】【F:src/neuroca/memory/manager/memory_manager.py†L490-L535】【F:src/neuroca/memory/manager/consolidation_guard.py†L113-L128】【F:tests/unit/memory/manager/test_maintenance_scheduler.py†L188-L236】【F:tests/unit/memory/manager/test_transactional_consolidation.py†L283-L308】【F:tests/unit/memory/manager/test_transactional_consolidation.py†L342-L408】
- [x] Introduce resource limits and watchdog safeguards that cap tier capacities, enforce timeouts, and evict or reject when thresholds are exceeded (currently `add_memory` accepts all inputs).【F:src/neuroca/memory/manager/resource_limits.py†L1-L173】【F:src/neuroca/memory/manager/memory_manager.py†L596-L703】【F:tests/unit/memory/manager/test_resource_limits.py†L1-L129】
- [x] Implement tier capacity pressure adaptation that dynamically tunes consolidation thresholds when tiers report saturation through maintenance metrics.【F:src/neuroca/memory/manager/capacity_pressure.py†L1-L103】【F:src/neuroca/memory/manager/memory_manager.py†L150-L247】【F:src/neuroca/memory/manager/maintenance.py†L250-L341】【F:tests/unit/memory/manager/test_capacity_pressure.py†L1-L92】
- [x] Write summarization fidelity tests (semantic similarity, entity retention) to validate the new summarizer once implemented.【F:tests/unit/memory/manager/test_summarization.py†L72-L172】
- [x] Create decay lifecycle tests using mocked clocks or time-shift scenarios so the decay engine is validated deterministically.【F:src/neuroca/memory/manager/decay.py†L60-L197】【F:tests/unit/memory/manager/test_decay_lifecycle.py†L1-L224】
- [x] Establish performance baselines (retrieval latency, consolidation throughput P50/P95) with real workloads instead of placeholder sleeps.【F:tests/performance/benchmarks.py†L201-L504】【F:tests/unit/performance/test_performance_benchmarks.py†L1-L62】
- [x] Design a high-concurrency performance stress scenario that drives the tiered backends concurrently to surface bottlenecks (beyond simulated thread pools).【F:tests/performance/benchmarks.py†L530-L724】【F:tests/unit/performance/test_performance_benchmarks.py†L59-L90】
- [x] Implement content and tag sanitization (PII/secret/prompt-injection filters) before storing metadata and tags; current ingestion blindly trusts input.【F:src/neuroca/memory/manager/sanitization.py†L1-L191】【F:src/neuroca/memory/manager/memory_manager.py†L807-L909】【F:tests/unit/memory/manager/test_sanitization.py†L1-L137】
- [x] Enforce retrieval scoping/RBAC so cross-user leakage cannot occur during multi-tenant queries (current `retrieve_memory` traverses all tiers without scope checks).【F:src/neuroca/memory/manager/scoping.py†L1-L167】【F:src/neuroca/memory/manager/memory_manager.py†L731-L878】【F:tests/unit/memory/manager/test_rbac_scoping.py†L1-L52】
- [x] Build prompt-injection adversarial tests that attempt to store malicious payloads and ensure sanitizers block or flag them.【F:tests/unit/memory/manager/test_sanitization.py†L119-L179】【F:tests/unit/memory/manager/test_sanitization.py†L220-L268】【F:src/neuroca/memory/manager/memory_manager.py†L1213-L1218】
- [x] Enrich logging with redaction and structured payloads so sensitive memory contents never leak via debug logs while still surfacing audit fields.【F:src/neuroca/memory/manager/audit.py†L32-L187】【F:src/neuroca/memory/manager/memory_manager.py†L1008-L1014】【F:tests/unit/memory/manager/test_audit_logging.py†L1-L82】
- [x] Emit structured events for MemoryCreated/Decay/Consolidated to power downstream audit/security hooks once the engines are complete.【F:src/neuroca/memory/manager/audit.py†L188-L251】【F:src/neuroca/memory/manager/memory_manager.py†L1748-L1754】【F:tests/unit/memory/manager/test_audit_logging.py†L84-L130】

## Phase 2 – Stability & Observability
- [x] Implement memory quality scoring and drift alerts to detect redundancy or stale clusters inside LTM; integrate with maintenance statistics.【F:src/neuroca/memory/manager/quality.py†L95-L233】【F:src/neuroca/memory/manager/memory_manager.py†L652-L739】【F:src/neuroca/memory/manager/maintenance.py†L140-L234】【F:tests/unit/memory/manager/test_maintenance_scheduler.py†L240-L305】
- [x] Add vector index integrity checks and reindex operations to the vector backend to monitor embedding drift.【F:src/neuroca/memory/backends/vector/components/integrity.py†L1-L291】【F:src/neuroca/memory/backends/vector/core.py†L66-L354】【F:tests/unit/memory/backends/test_vector_backend.py†L53-L95】
- [x] Define an embedding model swap safety procedure that performs staged re-embedding and compatibility validation before switching models.【F:src/neuroca/memory/backends/vector/components/model_swap.py†L1-L241】【F:src/neuroca/memory/backends/vector/core.py†L21-L85】【F:src/neuroca/memory/backends/vector/core.py†L336-L400】【F:tests/unit/memory/backends/test_vector_backend.py†L98-L240】
- [x] Publish metrics for promotions/sec, promotion_latency_ms, decay_count, orphan_count, tier_utilization%, and consolidation_failures using the Prometheus exporter plumbing.【F:src/neuroca/memory/manager/metrics.py†L16-L215】【F:src/neuroca/memory/manager/memory_manager.py†L210-L220】【F:src/neuroca/memory/manager/memory_manager.py†L655-L669】【F:src/neuroca/memory/manager/memory_manager.py†L934-L975】【F:src/neuroca/memory/manager/memory_manager.py†L1800-L1913】【F:tests/unit/memory/manager/test_metrics_publishing.py†L44-L192】
- [x] Deliver Grafana dashboards and alert thresholds that visualize backlog age and failed promotions sourced from the new metrics.【F:src/neuroca/memory/manager/metrics.py†L1-L235】【F:src/neuroca/infrastructure/monitoring/grafana/memory_maintenance.json†L1-L158】【F:src/neuroca/infrastructure/monitoring/rules/memory_maintenance_alerts.yml†L1-L27】
- [x] Provide structured event hooks so adaptive controllers can consume maintenance/consolidation events for feedback loops.【F:src/neuroca/memory/manager/events.py†L1-L206】【F:src/neuroca/memory/manager/maintenance.py†L1-L260】【F:tests/unit/memory/manager/test_events.py†L1-L72】【F:tests/unit/memory/manager/test_maintenance_scheduler.py†L1-L153】
- [x] Expand the configuration validation layer to fail fast on embedding mismatches, tier thresholds, and storage schema expectations across YAML/env/pydantic config inputs.【F:src/neuroca/memory/config/embedding.py†L49-L136】【F:src/neuroca/memory/config/validation.py†L62-L211】【F:src/neuroca/memory/factory.py†L95-L190】【F:tests/unit/memory/test_factory.py†L69-L243】
- [x] Formalize the API contract & versioning for memory endpoints to stabilize schemas and add backward-compatibility tests (current FastAPI route relies on internal manager wiring).【F:src/neuroca/api/routes/memory.py†L1-L8】【F:src/neuroca/api/routes/memory_v1.py†L1-L361】【F:src/neuroca/api/contracts/memory_v1.py†L1-L196】【F:tests/unit/api/test_memory_contract.py†L1-L164】
- [x] Document the architecture diagram, decay lifecycle math, failure recovery runbook, and tuning guide once instrumentation is in place.【F:docs/architecture/memory_manager_architecture.md†L1-L117】【F:docs/architecture/memory_decay_math.md†L1-L107】【F:docs/operations/memory_failure_recovery_runbook.md†L1-L104】【F:docs/operations/memory_tuning_guide.md†L1-L88】

## Phase 3 – Optimization & Developer Experience
- [x] Deliver CLI utilities for seeding, inspecting tiers, forcing consolidation, and reindexing the vector store to aid manual operations.【F:src/neuroca/cli/commands/memory.py†L137-L405】【F:tests/unit/cli/test_memory_cli.py†L129-L194】
- [x] Provide data migration and rollback scripts for summary or embedding schema evolution (beyond ad-hoc SQL backups).【F:scripts/memory_schema_migration.py†L1-L348】【F:src/neuroca/memory/migrations/schema.py†L1-L175】【F:tests/unit/memory/migrations/test_schema_migration.py†L1-L95】
- [x] Publish developer seeding and sample scenario packs so standard fixtures exist for testing complex cognitive flows.【F:docs/development/memory_sample_packs.md†L1-L63】【F:src/neuroca/memory/seeding/__init__.py†L1-L82】【F:src/neuroca/memory/seeding/packs/collaborative_brainstorm.jsonl†L1-L5】【F:tests/unit/cli/test_memory_cli.py†L126-L149】【F:tests/unit/memory/seeding/test_sample_packs.py†L1-L44】
- [x] Automate embedding drift detection & notification using periodic comparisons of embedding distributions and vector index health metrics.【F:src/neuroca/memory/manager/drift_monitor.py†L1-L239】【F:src/neuroca/memory/manager/maintenance.py†L1-L208】【F:tests/unit/memory/manager/test_drift_monitor.py†L1-L146】
- [x] Author API integration smoke tests that exercise store → consolidate → retrieve → decay → summarize to cover the full lifecycle (current integration test only covers vector retrieval).【F:tests/integration/api/test_memory_lifecycle.py†L16-L390】
- [x] Ensure event emission is idempotent so downstream listeners never receive duplicate triggers during retries or failover.【F:src/neuroca/core/events/idempotency.py†L1-L92】【F:src/neuroca/memory/manager/events.py†L17-L214】【F:src/neuroca/memory/manager/audit.py†L252-L343】【F:tests/unit/memory/manager/test_events.py†L101-L163】【F:tests/unit/memory/manager/test_audit_logging.py†L107-L165】
- [x] Add back-pressure mechanisms that queue or reject writes when tiers are overloaded instead of blindly accepting new memories.【F:src/neuroca/memory/manager/backpressure.py†L1-L212】【F:src/neuroca/memory/manager/memory_manager.py†L1202-L1254】【F:tests/unit/memory/manager/test_backpressure.py†L1-L284】
- [x] Define timeout and retry policies per backend (vector, Redis, SQL) within the factory/tier adapters, refreshing the guard when instances are reused and covering defaults/overrides in regression tests.【F:src/neuroca/memory/backends/factory/storage_factory.py†L120-L214】【F:tests/unit/memory/backends/test_operation_policy.py†L1-L196】
- [x] Implement circuit breaker or degraded modes that can skip consolidation if backlog size or failure rate crosses thresholds.【F:src/neuroca/memory/manager/circuit_breaker.py†L1-L187】【F:src/neuroca/memory/manager/memory_manager.py†L260-L283】【F:src/neuroca/memory/manager/memory_manager.py†L737-L783】【F:src/neuroca/memory/manager/maintenance.py†L356-L384】【F:tests/unit/memory/manager/test_maintenance_scheduler.py†L362-L458】
- [ ] Validate redundancy/snapshot export paths for long-term memory so recovery and restore procedures are exercised regularly.【F:src/neuroca/memory/tiers/ltm/core.py†L1-L132】
